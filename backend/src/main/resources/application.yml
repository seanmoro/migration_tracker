spring:
  application:
    name: migration-tracker-api
  
  servlet:
    multipart:
      enabled: true
      max-file-size: 500MB
      max-request-size: 500MB
  
  datasource:
    # Database path will be resolved in DatabaseConfig.java
    # This is a placeholder - actual path resolution happens in code
    url: jdbc:sqlite:../resources/database/migrations.db
    driver-class-name: org.sqlite.JDBC

# Migration Tracker Configuration
# Set MIGRATION_TRACKER_DB_PATH environment variable to override database location
migration:
  tracker:
    database:
      path: ${MIGRATION_TRACKER_DB_PATH:}
    
  jdbc:
    template:
      query-timeout: 30

# PostgreSQL connection settings (read from tracker.yaml or environment)
postgres:
  blackpearl:
    host: ${MT_BLACKPEARL_HOST:localhost}
    port: ${MT_BLACKPEARL_PORT:5432}
    database: ${MT_BLACKPEARL_DATABASE:tapesystem}
    username: ${MT_BLACKPEARL_USERNAME:postgres}
    password: ${MT_BLACKPEARL_PASSWORD:}
    # Data directory path for data directory backups (optional)
    # If not set, will query PostgreSQL or use common locations
    data-directory: ${MT_BLACKPEARL_DATA_DIRECTORY:}
  rio:
    host: ${MT_RIO_HOST:localhost}
    port: ${MT_RIO_PORT:5432}
    database: ${MT_RIO_DATABASE:rio_db}
    username: ${MT_RIO_USERNAME:postgres}
    password: ${MT_RIO_PASSWORD:}
    # Data directory path for data directory backups (optional)
    # If not set, will query PostgreSQL or use common locations
    data-directory: ${MT_RIO_DATA_DIRECTORY:}
  backup:
    # Number of backup directories to keep when restoring
    # Old backups will be automatically deleted to prevent directory from getting too large
    keep-count: ${POSTGRES_BACKUP_KEEP_COUNT:3}

  sql:
    init:
      mode: always
      data-locations: classpath:data.sql
      continue-on-error: true

server:
  port: ${SERVER_PORT:8080}
  address: ${SERVER_ADDRESS:0.0.0.0}
  servlet:
    context-path: ${SERVER_CONTEXT_PATH:}
  # Increase timeouts for large file uploads
  connection-timeout: 600000  # 10 minutes
  tomcat:
    connection-timeout: 600000  # 10 minutes
    max-connections: 200
    threads:
      max: 200
      min-spare: 10

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html

logging:
  level:
    com.spectralogic.migrationtracker: DEBUG
    org.springframework.web: INFO
    org.springframework.jdbc: DEBUG
  file:
    name: ../log/migration_tracker_api.log
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} %-5level %logger{36} - %msg%n"
